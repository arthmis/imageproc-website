<!DOCTYPE html>
<html>

    <head>
        <title>Image Processing</title>
        <meta content="text/html;charset=UTF-8" http-equiv="Content-Type"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.5">
        <link rel="stylesheet" type = "text/css" href="main.css"/>
        <!-- <link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet"> -->

    </head>

    <body>
        <nav class="navbar">
            <a href="index.html">
                <!-- Icon made by Freepik from www.flaticon.com -->
                <img src="./icons/house-black-silhouette-without-door.svg" alt="home page">
            </a>
            
            <button id="upload-image">Upload Image</button>
        </nav>
        <div id="main">
            <div id="options">
                <div id="input-image"> 
                    <input type="file" id="file-input" accept="image/png, image/jpeg" style="display: none;">
                    <!-- <button id="upload-image">Import</button> -->
                </div>

                <ul class="processing-category"><span>Pixel Operations</span>
                    <li id="invert-option" class="sidebar-elem sidebar-first-elem">Invert</li>
                    <li id="gamma-option" class="sidebar-elem">Gamma</li>
                </ul>

                <ul class="processing-category"><span>Blur</span>
                    <li id="blur-options" class="processing-options sidebar-elem sidebar-first-elem">Box Blur</li>
                </ul>
            </div>
            <div id="image-options">
                <div id="two-canvases-wrapper">
                    <div id="two-canvases">
                        <canvas id="input-canvas" class="one-active-canvas"></canvas>
                        <canvas id="output-canvas"></canvas>
                    </div>
                    <div id="processing-options" style="display: none;">
                        <div id="box-blur-slider-wrapper" style="display: none;">
                            <input id="box-blur-slider" type="range" name="box-blur" min="1" max="51" step="2">
                            <label for="box-blur">box diameter</label>
                        </div>
                        <div id="gamma-slider-wrapper" style="display: none;">
                            <div class="slider-value">
                                <label for="gamma-value">Gamma</label>
                                <input id="gamma-value" type="text" name="gamma-value">
                            </div>
                            <div class="slider">
                                <input  id="gamma-slider" type="range" name="gamma" min="0.1" max="5" step="0.01">
                            </div>
                        </div>
                    </div>
                    <div id="algorithm-info">
                        <div id="invert-info" class="algorithm-info algorithm-explanation" style="display: none;">
                            <h2>How Invert works</h2>
                            <p>
                                Color inversion is when the luminance of the pixel gets mapped to the opposite.
                                In other words, white gets mapped to black and black is mapped to white. If we assume
                                an image with the color channels red, green, blue and 8 bits per channel, then
                                the formula to map the luminance value is given by:
                                <blockquote>
                                    <i>I<sub>invert</sub>(x, y) = Luminance<sub>max</sub> - I(x, y)</i>
                                </blockquote>                        
                                where <i>I</i> is the image, <i>Luminance<sub>max</sub></i> is 255 for an image with 8 bits
                                per color channel, and <i>x</i> and <i>y</i> are the coordinates of the pixel.
                                Using the above formula, if you have the RGB pixel <i>I(x, y)</i> = (50, 120, 200)
                                then <i>I<sub>invert</sub>(x, y)</i> = (205, 135, 55).
                            </p>
                        </div>
                        <div id="box-blur-info" class="algorithm-info algorithm-explanation" style="display: none;">
                            <h2>How Box Blur works</h2>
                            <p>
                                Box blur is a <a href="https://en.wikipedia.org/wiki/Convolution">convolution filter</a> that blurs an image. 
                                It is also known as a mean filter. What it essentially does is add all the neighboring 
                                pixels of the pixel it is centered on. Then it 
                                takes the average of all the pixels including the centered pixel and uses this new value 
                                as the value of the new pixel in the new image. 
                            </p>
                            <p>
                                The <a href="https://en.wikipedia.org/wiki/Kernel_(image_processing)">kernel</a> used 
                                for convolution filter in image processing comes in the form of a matrix: 
                            </p>
                            <div class="diagram">
                                <img src="images/box-blur.png" alt="box blur kernel" style="width: 20em; height: 20em;">
                                <p>
                                    Box Blur Kernel
                                </p>
                            </div>
                            <p>
                                The diameter of the kernel is measured in pixels. So the above kernel is 3 pixels wide
                                by 3 pixels high. Each square overlaps a pixel on the image. The kernel can be any diameter
                                from 1 to <span style="font-size: 1.5em;">&infin;</span>; larger kernels create a stronger blur.
                            </p>
                            <p>
                                Show an example of how the filter centers on a pixel.
                            </p>
                            <div class="diagram">
                                <img src="" alt="Box blur convolution start">
                                <p>box blur convolution beginning</p>
                            </div>
                            <p>
                                The diagram shows a problem with convolution filters. Sometimes the filter,
                                at the edges, goes beyond the border of the image. If your image is represented
                                by an array, then trying to access outside of the image would be an out of bounds
                                access, which should crash the program. There are a few ways to deal with filters
                                at the edges of images. One would be to create a clone of the image with the border
                                extended to accomodate the filter size. This would be slow and impractical. Another 
                                choice is to wrap the filter around the image. So if the filter passes the top border
                                of the image then the part that doesn't overlap will overlap the bottom of the image.  
                                Besides that, one can take the pixels at the border and use those as the pixel value
                                whenever exceeding the border. You can also ignore the boundaries which will shrink the 
                                image, but that probably isn't correct for most applications.
                            </p>
                            <p>
                                Convolution matrices sometimes have a property that makes them separable.
                                Being separable means if you have a n x n matrix, <i>A</i> then <i>A</i> can be split 
                                into a <i>1 x n</i> row vector, <i>B</i> and a <i>n x 1</i> column vector, <i>C</i>.
                                These vectors multiplied together recreate <i>A</i>.
                            </p>
                            <div class="diagram">
                                <img src="" alt="separable filter">
                                <p>separable box blur</p>
                            </div>
                            <p>Heres a demo of how box blur kernel convolves with an image: </p>
                            <div class="diagram">
                                <img class="box-blur-demo" src="./images/box-blur.gif" alt="box blur animation">
                                <p>
                                    3 x 3 box blur demo
                                </p>
                            </div>
                        </div>
                        <div id="gamma-info" class="algorithm-info algorithm-explanation" style="display: none;">
                            <h2>How Gamma works</h2>
                            <p>
                                Gamma, otherwise known as gamma encoding and decoding, or gamma correction, refers to expanding or compressing an image's range 
                                of intensity values. When an imaging system captures an image the light intensity information
                                is captured linearly. In other words, if the light intensity is recorded by the camera
                                with a value of 100, then 200 would be the equivalent of twice the brightness of 100.
                                However, the human vision system perceives light nonlinearly. We are more sensitive to darker tones
                                than lighter tones. Gamma encoding takes advantage of our perception of light intensity by transforming 
                                the linear output of digital imaging devices into a perceptually uniform scale. 

                            </p>
                            <p>
                                An example of perceptual brightness vs linear brightness differences is shown by the diagram below:
                            </p>
                            <div class="diagram">
                                <img class="gamma-images" src="./images/linear_image.jpeg" alt="Linear Image example">
                                <p>
                                    Perceptually linear image
                                </p>
                                <img class="gamma-images" src="./images/gamma_encoded_image.jpeg" alt="gamma encoded image">
                                <p>
                                    Linear image
                                </p>
                            </div>
                            <p>
                                The above images show the effect of an encoded image and an image without gamma
                                encoding. 
                                
                                The transformation for gamma encoding is:
                                <p class="formula">
                                    <i>I<sub>encoded</sub>(x, y) = I<sub>linear</sub>(x, y)<sup>1/&#947</sup></i>
                                    <p style="text-indent: 1em">
                                        where &#947 is the gamma value, x and y are the pixel coordinates, and I is the image.</p>
                                </p>

                                The difference in value between each shade for the perceptually linear image 
                                isn't the same; however, the delta between each shade on the linear image is the same.
                                However, the linear image doesn't appear to have a natural progression between each shade
                                while the perceptually linear image does. The difference between each shade looks more uniform in the
                                perceptually linear image because of our nonlinear vision system. When being displayed the monitor and GPU
                                apply another gamma transformation, which is supposed to effectively undo the gamma encoding already applied to image.
                                This is known as gamma decoding. The transformation used for gamma decoding is given by:
                                
                                <p class="formula">
                                    <i>I<sub>linear</sub>(x, y) = I<sub>encoded</sub>(x, y)<sup>&#947</sup></i>
                                </p>
                                 
                                The monitor expects a gamma to be applied to the image before being displayed. The reason
                                why the perceptually linear image looks uniform is because the display gamma closely approximates 
                                the perceptual uniformity the human vision system expects. For most display devices, the gamma 
                                encoding they expect is given by:

                                <p class="formula">
                                    <i>I<sub>encoded</sub>(x, y) = I<sub>linear</sub>(x, y)<sup>1/2.2</sup></i>
                                </p>
                                Then to display the image, the monitor will apply the gamma:
                                <p class="formula">
                                    <i>I<sub>linear</sub>(x, y) = I<sub>encoded</sub>(x, y)<sup>2.2</sup></i>
                                </p>
                                to decode the image.
                            </p>
                            <h2>Why Gamma is Useful</h2>
                            <p>
                                Gamma values of the range &#947 &lt; 1 map a narrow range of dark tones to a wider range of values. Gamma 
                                values of the range &#947 &gt; 1 map a wider range of lighter tones to darker tones. This allows
                                less bits to describe lighter tones while using more bits to describe darker tones, which 
                                humans are more sensitive to. The benefit of this is that gamma encoded images can be described 
                                with only 8 bits in order to get smooth gradients throughout the image. 
                            </p>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <script type="module" src="./js/dist/index.js"></script>
    </body>
</html>
